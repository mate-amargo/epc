#!/bin/bash
# -----------------------------------------------------------
# Autor: Juan Alberto Regalado GalvÃ¡n
# Fecha de comienzo: Sabado 23 de Octubre de 2010 a las 18:48
# -----------------------------------------------------------

VERSION=1.0
E_SUCCESS=0

VERBOSE=false

HELP=\
"Uso: epc [OPCIONES] COMANDOS

  EPC - Easy Prompt Changer
  Un programa simple para editar y cambiar el prompt

Los argumentos mandatorios u opcionales para un determinado
comando largo son tambien mandatorios u opcionales para un
comando corto.
Las opciones van antes que los comandos

OPCIONES:
  -v, --verbose		Produce salida detallada
COMANDOS:
  -h, --help		Muestra la ayuda y sale
  -V, --version		Muestra la version y sale
  -n, --new 'STRING'	Crea un prompt con la informacion
                        dada en STRING
"

PS1=""

# Colores
# Foreground
BLACK='\\\[\\\e[30m\\\]'
RED='\\\[\\\e[31m\\\]'
GREEN='\\\[\\\e[32m\\\]'
YELLOW='\\\[\\\e[33m\\\]'
BLUE='\\\[\\\e[34m\\\]'
PURPLE='\\\[\\\e[35m\\\]'
CYAN='\\\[\\\e[36m\\\]'
GRAY='\\\[\\\e[37m\\\]'
# Background
BBLACK='\\\[\\\e[40m\\\]'
BRED='\\\[\\\e[41m\\\]'
BGREEN='\\\[\\\e[42m\\\]'
BYELLOW='\\\[\\\e[43m\\\]'
BBLUE='\\\[\\\e[44m\\\]'
BPURPLE='\\\[\\\e[45m\\\]'
BCYAN='\\\[\\\e[46m\\\]'
BGRAY='\\\[\\\e[47m\\\]'
# Atributos de texto
RESET='\\\[\\\e[0m\\\]'
BRIGHT='\\\[\\\e[1m\\\]'
DIM='\\\[\\\e[2m\\\]'
UNDERLINE='\\\[\\\e[4m\\\]'
BLINK='\\\[\\\e[5m\\\]'
REVERSE='\\\[\\\e[7m\\\]'
HIDDEN='\\\[\\\e[8m\\\]'


# Funciones

new_prompt () {

# Parseamos el string para crear un prompt
for var in $STRING; do
  case $var in
    # Colores
    # Foreground			Background
    black)  PS1="$PS1$BLACK" ;;		bblack) PS1="$PS1$BBLACK" ;;
    red)    PS1="$PS1$RED" ;;		bred) PS1="$PS1$BRED" ;;
    green)  PS1="$PS1$GREEN" ;;		bgreen) PS1="$PS1$BGREEN" ;;
    yellow) PS1="$PS1$YELLOW" ;;	byellow) PS1="$PS1$BYELLOW" ;;
    blue)   PS1="$PS1$BLUE" ;;		bblue) PS1="$PS1$BBLUE" ;;
    purple) PS1="$PS1$PURPLE" ;;	bpurple) PS1="$PS1$BPURPLE" ;;
    cyan)   PS1="$PS1$CYAN " ;;		bcyan) PS1="$PS1$BCYAN" ;;
    gray)   PS1="$PS1$GRAY " ;;		bgray) PS1="$PS1$BGRAY" ;;

    # Atributos del texto
    reset)     PS1="$PS1$RESET" ;;
    bright)    PS1="$PS1$BRIGHT" ;;
    dim)       PS1="$PS1$DIM" ;;
    underline) PS1="$PS1$UNDERLINE" ;;
    blink)     PS1="$PS1$BLINK" ;;
    reverse)   PS1="$PS1$REVERSE" ;;
    hidden)    PS1="$PS1$HIDDEN" ;;

    # Informacion del sistema
    user)         PS1="$PS1\\\u" ;;
#    users)    PS1="$PS1" ;; #TODO
    host)         PS1="$PS1\\\h" ;;
    hostfull)     PS1="$PS1\\\H" ;;
    jobs)         PS1="$PS1\\\j" ;;
    shell)        PS1="$PS1\\\s" ;;
    bashversion)  PS1="$PS1\\\v" ;;
    bashrealease) PS1="$PS1\\\V" ;;
    wdir)	  PS1="$PS1\\\w" ;;
    basedir)      PS1="$PS1\\\W" ;;
    histnum)	  PS1="$PS1\\\!" ;;
    cmdnum)	  PS1="$PS1\\\#" ;;
    sign)	  PS1="$PS1\\\$" ;;
    exitcode)	  PS1="$PS1\\\$?" ;;

    # Miscelaneos
    bell)         PS1="$PS1\\\a" ;;
    newline)	  PS1="$PS1\\\n" ;;
    creturn)      PS1="$PS1\\\r" ;;

    # Texto
    \"* | *\") PS1="$PS1$var" ;;
    space)     PS1="$PS1\\ " ;;
    quote)     PS1="$PS1\\\"" ;;

  esac
done

echo "PS1=$PS1"

}

# Cuerpo principal
while (( $# > 0 )); do
  case $1 in
    -h | --help)
      echo "$HELP" >&2
      exit $E_SUCCESS
      ;;
    -V | --version)
      echo "epc-$VERSION" >&2
      exit $E_SUCCESS
      ;;
    -v | --verbose)
      VERBOSE=true
      ;;
    -n | --new)
      STRING=${@#$1}
      new_prompt;
      exit $?
      ;;
  esac
  shift
done
